<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name = "viewport" content="width=device-width", initial-scale=1.0>
    <meta http-equiv="X-UA-compatible"
    content="ie=edge">
    <title>Asynchronous Javascript</title>
</head>
<body>
    <h1>Asynchronous Javascript</h1>
    <script>
        // const second = () => {
        //     setTimeout(() => {
        //         console.log('second');
        //     }, 2000);
        // };

        // const first = () => {
        //     console.log('Hey There!');
        //     second();
        //     console.log('The end');
        // };
        // first();

        /**
         * traditional way of asynchronous js
         * 
        setTimeout(() => {
            const recipeId = [548, 653, 425, 379];
            console.log(recipeId);

            setTimeout(id => {
                const recipe = {title: 'potato chips', publisher : 'KMP'};
                console.log(`${id}: ${recipe.title}`);

                setTimeout(publisher => {
                    const recipe2 = {title: 'fried rice', publisher: 'KMP'};
                    console.log(`${publisher}: ${recipe.title}`);
                }, 1500, recipe.publisher);
            }, 1500, recipeId[2]);
        }, 1500);
        */

        const getIds = new Promise((resolve, reject) => {
            setTimeout(() => {
                resolve([548, 653, 425, 379]);
            }, 1500);
        });

        const getRecipe = recId => {
            return new Promise((resolve, reject) => {
                setTimeout(ID => {
                    const recipe = {'title': 'potato chips', 'publisher': 'KMP'};
                    resolve(`${ID}: ${recipe.title}`);
                }, 1500, recId);
            })
        };

        const getRelated = publisher => {
            return new Promise((resolve, reject) => {
                setTimeout(publisher => {
                    const recipe = {'title': 'fried rice', 'publisher': 'Jonas'};
                    resolve(`${publisher}: ${recipe.title}`);
                }, 1500, publisher)
            });
        };

        /* traditional confusing promise consuming way (callback hell)

        getIds.then(Ids => {
            console.log(Ids);
            return getRecipe(Ids[2]);
        })
        .then(recipe => {
            console.log(recipe);
            return getRelated('KMP');
        })
        .then(recipe => {
            console.log(recipe);
        })
        .catch(error => {
            console.log(error);
        })

        */

        /*
        *   async / await
        */

        async function getRecipeAW()
        {
            const Ids = await getIds;
            console.log(Ids);
            const recipe = await getRecipe(Ids[2]);
            console.log(recipe);
            const related = await getRelated('KMP');
            console.log(related);

            return recipe;
        }

        // const result = getRecipeAW();
        // console.log(result);  // this won't show any result because getRecipeAW is still running in background and  didn't return any value in this present time
        getRecipeAW().then(result => {
            console.log(result);
        })

    </script>
</body>